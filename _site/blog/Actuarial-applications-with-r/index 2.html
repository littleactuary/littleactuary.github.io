<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>(Actuarial) tools with R &#8211; Little Actuary</title>
<meta name="description" content="How to write a well-structured and understandable R program">
<meta name="keywords" content="R, Actuary, Actuariat, Actuarial">



<!-- Twitter Cards -->
<meta name="twitter:title" content="(Actuarial) tools with R">
<meta name="twitter:description" content="How to write a well-structured and understandable R program">
<meta name="twitter:site" content="@duc_hien_vu">
<meta name="twitter:creator" content="@duc_hien_vu">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="(Actuarial) tools with R">
<meta property="og:description" content="How to write a well-structured and understandable R program">
<meta property="og:url" content="/blog/Actuarial-applications-with-r/">
<meta property="og:site_name" content="Little Actuary">





<link rel="canonical" href="/blog/Actuarial-applications-with-r/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Little Actuary Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="/assets/js/vendor/html5shiv.min.js"></script>
  <script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="/about/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="/vitae/" >Vitae</a></li>
		  
		    
		        
		    
		    <li><a href="/blog/" >Blog</a></li>
		  
		    
		        
		    
		    <li><a href="/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="/" class="site-logo" rel="home" title="Little Actuary"><img src="/images/site-logo.png" width="200" height="200" alt="Little Actuary logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="/">Little Actuary</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">A blog to keep track of my progress on Actuarial Science and Data Science learning</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="/tags/#R" title="Pages tagged R">R</a></li><li><a href="/tags/#Actuary" title="Pages tagged Actuary">Actuary</a></li><li><a href="/tags/#Actuariat" title="Pages tagged Actuariat">Actuariat</a></li><li><a href="/tags/#Actuarial" title="Pages tagged Actuarial">Actuarial</a></li>
        </ul>
        
          <h1 class="entry-title">(Actuarial) tools with R</h1>
        
      </header>
      <footer class="entry-meta">
        
        
        
          <img src="/images/bio-photo.jpg" class="bio-photo" alt="Duc-Hien VU bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Duc-Hien VU</span></span>
        <span class="entry-date date published"><time datetime="2015-10-30T20:39:55+01:00"><i class="fa fa-calendar-o"></i> October 30, 2015</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=R,Actuary,Actuariat,Actuarial&amp;text=(Actuarial)%20tools%20with%20R&amp;url=/blog/Actuarial-applications-with-r/&amp;via=duc_hien_vu" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=/blog/Actuarial-applications-with-r/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=/blog/Actuarial-applications-with-r/" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
      </footer>
      <div class="entry-content">
        <p>At school, I have done some simple projects with R. Most of them were written in a dirty way (all in a same R script). Then I had a chance to work with R more seriously during my two last internships. I have learned R by reading R programs developed by experienced actuaries. Of course they are not programmers, but their programs are well-structured and much more readable and understandable than mine. A well-structured program (especially when dealing with a complex problem) helps you easily verify and debug your code and help others (who have to audit or modify your code) understand it quickly and effortlessly. Here are some rules that I find very useful for deploying a program with R. I believe they are also true for almost other languages.</p>

<h3 id="moduling-your-program">#1: Moduling your program</h3>

<p>If your program is long and complex, instead of using one single R script, you should divide your program into separate modules whenever possible and store them in separate R scripts. For example, if you want to develop a pricing tool that proposes 2 different pricing methods, your program structure may look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>input reading
claims modeling 
if (method ==1)
    pricing method 1
else
    pricing method 2
</code></pre>
</div>

<p>Your R program will be called through a <code class="highlighter-rouge">main.R</code> script:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># functions loading       </span>
<span class="kn">source</span><span class="p">(</span><span class="s">&quot;F-simple_functions.R&quot;</span><span class="p">)</span>
<span class="kn">source</span><span class="p">(</span><span class="s">&quot;F-claims_modeling.R&quot;</span><span class="p">)</span>
<span class="kn">source</span><span class="p">(</span><span class="s">&quot;F-pricing_method1.R&quot;</span><span class="p">)</span>
<span class="kn">source</span><span class="p">(</span><span class="s">&quot;F-pricing_method2.R&quot;</span><span class="p">)</span>

<span class="c1"># input reading</span>
<span class="kn">source</span><span class="p">(</span><span class="s">&quot;E-input_reading.R&quot;</span><span class="p">)</span>

<span class="c1"># claim modeling</span>
<span class="kn">source</span><span class="p">(</span><span class="s">&quot;E-claims_modeling.R&quot;</span><span class="p">)</span>
<span class="c1"># pricing </span>
<span class="kr">if</span> <span class="p">(</span>method <span class="o">==</span> <span class="m">1</span><span class="p">)</span>
    <span class="kn">source</span><span class="p">(</span><span class="s">&quot;E-pricing_method1.R&quot;</span><span class="p">)</span>
<span class="kp">else</span>
    <span class="kn">source</span><span class="p">(</span><span class="s">&quot;E-pricing_method2.R&quot;</span><span class="p">)</span></code></pre></div>

<p>This script is the main workflow where your program tells R what to do. To run your program, just execute the <code class="highlighter-rouge">main.R</code> script! Firstly, R will load 4 different scripts that only contain functions (that’s why their names begin with <code class="highlighter-rouge">F-</code>).  While <code class="highlighter-rouge">F-simple_functions.R</code> stores some simple functions that will be used almost everywhere in your program, <code class="highlighter-rouge">F-claims_modeling.R"</code> is reserved to specific functions that will be called in <code class="highlighter-rouge">E-claims_modeling.R</code> and so one. Once all functions are loaded, R will call executive scripts whose name begins with <code class="highlighter-rouge">E-</code>, in a scenario that you have pre-determined in the main script.</p>

<p>You can also replace each executive script by creating and calling a big function with parameters in order to make your R modules really independent (however, in my experience, it is sometimes complicate to do so). While structuring the program seems useless in this simplified example, it turns out to be very helpful when working with more than hundred lines of code per module.</p>

<h3 id="commenting-code">#2: Commenting code</h3>
<p>Comment a complex line of code, a function or a variable is a good habit and should be done whenever it is possible. I remember how hard it was for me to understand a bloc of code written by others (or even by myself long ago) without any comments.</p>

<p>I recently found out that it is better to comment a function from inside. Let’s take an example where I declare the function <code class="highlighter-rouge">beautifulAmount()</code> in <code class="highlighter-rouge">F-simple_functions.R</code> and I call it in the main script <code class="highlighter-rouge">main.R</code>. I used to comment this function this way:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># function to dislay claim amount in a beautiful way</span>
beautifulAmount <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span><span class="kp">format</span><span class="p">(</span><span class="kp">round</span><span class="p">(</span>x<span class="o">/</span><span class="m">1000</span><span class="p">),</span>scientific<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> big.mark<span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)}</span></code></pre></div>

<p>When I look at this function in <code class="highlighter-rouge">F-simple_functions.R</code>, I can understand it immediately thanks to the comment. However, if I identify this function in <code class="highlighter-rouge">main.R</code>:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">y <span class="o">&lt;-</span> beautifulAmount<span class="p">(</span>x<span class="p">)</span></code></pre></div>

<p>and I forget what it was supposed to do, I’m obligated to re-open <code class="highlighter-rouge">F-simple_functions.R</code>. Now, I put my comment inside the function:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">beautifulAmount <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span>
<span class="c1"># function to dislay claim amount in a beautiful way</span>
<span class="kp">format</span><span class="p">(</span><span class="kp">round</span><span class="p">(</span>x<span class="o">/</span><span class="m">1000</span><span class="p">),</span>scientific<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> big.mark<span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>Whenever I have a doubt with the purpose of this function, I only need to write “beautifulAmount” in my R console and hit enter. R will show me the full code of the function <code class="highlighter-rouge">beautifulAmount()</code>, including the comment inside. By this way, I don’t need to open <code class="highlighter-rouge">F-simple_functions.R</code> to understand <code class="highlighter-rouge">beautifulAmount()</code>.</p>

<h3 id="naming-your-variables-wisely">#3: Naming your variables wisely</h3>

<p>A good variable name is a meaningful name, not too short, not too long. However, when naming an index variable, we usually choose a meaningless letter such as “i”, “j” or “k”. In this case, a friend of mine has taught me that “ii” is better than “i”. Instead of:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">beautifulAmount <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>n<span class="p">){</span>
<span class="kc">...</span>
<span class="p">}</span></code></pre></div>

<p>you should write:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">beautifulAmount <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span>
<span class="kr">for</span> <span class="p">(</span>ii <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>n<span class="p">){</span>
<span class="kc">...</span>
<span class="p">}</span></code></pre></div>

<p>Using the second option, when you need to find and modify your loop, you just need to jump into your R script and search (<code class="highlighter-rouge">Ctrl + F</code>) “ii”. With the first option, doing a search of “i” letter in your whole script seems desperate.</p>

<h3 id="using-list">#4: Using list()</h3>
<p>If you have many variables to work with in your program, you should group them into lists. The two basic lists are <code class="highlighter-rouge">input()</code>and <code class="highlighter-rouge">output()</code> but you are not obligated to stay with these two. In the above example of pricing, you can create one list for variables of each method. By doing so, each method is somehow similar to an object.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">output.method1 <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span>
output.method2 <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span></code></pre></div>

<p>To declare variables that will be used in the method 1:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">output.method1<span class="o">$</span>name <span class="o">&lt;-</span> <span class="s">&quot;historical method&quot;</span>
output.method1<span class="o">$</span>premium <span class="o">&lt;-</span> <span class="kp">mean</span><span class="p">(</span>frequency<span class="p">)</span><span class="o">*</span><span class="kp">mean</span><span class="p">(</span>severity<span class="p">)</span></code></pre></div>

<p>For listing all elements of this list</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">print</span><span class="p">(</span>output.method1<span class="p">)</span> <span class="c1"># or without print()</span></code></pre></div>

<p>For listing the names of all elements of this list, write:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">names</span><span class="p">(</span>output.method1<span class="p">)</span></code></pre></div>

<p>These simple habits of programming are surprisingly useful in practice, for both code writers and code readers.</p>


        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'littleactuary'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/blog/mathjax-example/" class="btn" title="MathJax Example">Previous</a>
      
      
        <a href="/blog/blogging-like-a-ninja/" class="btn" title="Blogging like a ninja with Jekyll">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2016 Duc-Hien VU. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/duc_hien_vu" title="Duc-Hien VU on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/vuhien" title="Duc-Hien VU on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	
	<a href="https://linkedin.com/in/duc-hien-vu-50b20627" title="Duc-Hien VU on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	
	<a href="https://instagram.com/vuduchien" title="Duc-Hien VU on Instagram" target="_blank"><i class="fa fa-instagram fa-2x"></i></a>
	
	<a href="https://github.com/littleactuary" title="Duc-Hien VU on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = '';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




</body>
</html>
